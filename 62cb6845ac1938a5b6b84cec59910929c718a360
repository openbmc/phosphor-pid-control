{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "4ce18e54_c45e85ff",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2024-11-27T04:27:33Z",
      "side": 1,
      "message": "Hi @Josh, added you to the Reviewers list cuz I think you might have some advice on my PS. Sorry if it bothers you.",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a64bc620_0bddc160",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1001198
      },
      "writtenOn": "2024-11-27T09:17:24Z",
      "side": 1,
      "message": "I have minor comments for your commit",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bcd1d893_0a287677",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-11-27T10:52:53Z",
      "side": 1,
      "message": "This is a good idea. However, I have some questions about the implementation, and about the change to the meaning of the `MissingIsAcceptable` flag.\n\nI like your explanations in the comments. This is good logic. However, it makes a behavioral change to the `MissingIsAcceptable` flag that extends it far beyond its original purpose, and may cause side effects with people trying to use it. We might want to have some discussion about this. Have you mentioned it on the Discord yet?\n\nPlease take a look at the feature request, which your contribution directly helps out with:\n\nhttps://github.com/openbmc/phosphor-pid-control/issues/33",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cdc8237b_9d7dbbf6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2024-11-28T09:57:31Z",
      "side": 1,
      "message": "Thank you for your review.\n\n\u003e Have you mentioned it on the Discord yet?\n\nI have asked on Discord #general channel about why in case of a sensor missing from DBus, DBus parsing method continues with the remaining sensors, while JSON parsing method fails and rescans. But I received only one answer that suggests pushing a patch myself to request a change.\n\n\u003e https://github.com/openbmc/phosphor-pid-control/issues/33\n\nI found this issue you raised while trying to figure out what to do. That\u0027s why I involved you in. Because in our system, we have some important sensors that if missing, fans need to react and we want to use D-Bus config instead of JSON. phosphor-fan has phosphor-fan-control service to monitor events and set speed accordingly but it does not sync with phosphor-pid-control.\n\nThis patch of mine tries to align to the expectation in the issue because they make sense to me, too. However, the scope of the issue is big, not to mention that we just moved to phosphor-pid-control from phosphor-fan, and we don\u0027t use PID algorithm but just Stepwise, I don\u0027t have much of the knowledge to come up with something that can cover all the aspects. But I think `MissingIsAcceptable` should be what its name describes, in which `missing` also means when the sensor is not on D-Bus. Therefore, I pushed this patch to first address the problem that I\u0027m facing. I\u0027m OK that we can bring this patch to Discord again to ask for more comments.\n\nOne issue I see is that. When a sensor is purposedly built as failed because it\u0027s missing from D-Bus and it\u0027s not in the `MissingIsAcceptable` list. If the controller is configured with `InputUnavailableAsFailed`\u003dfalse, the failed state will be bypassed. I don\u0027t know why it\u0027s a high priority to return false right here https://github.com/openbmc/phosphor-pid-control/blob/951aff4cd1ba07f6d25400b7ac87621e76267eab/dbus/dbuspassive.cpp#L158. Should it be reconsidered?",
      "parentUuid": "bcd1d893_0a287677",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c703f18c_f6abf8b6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-11-30T09:06:36Z",
      "side": 1,
      "message": "I agree that we need to unify the D-Bus behavior and the JSON behavior so that they behave the same. It\u0027s a bug that they are different.\n\nAs for `MissingIsAcceptable`, the purpose of it was to allow PID loops to continue running, without throwing the PID loop into failsafe mode, if a constituent input was missing or malfunctioning. This is to cover the case of input sensors that are nice to have around, perhaps for faster thermal response, but not mandatory for correct thermal control of the system.\n\nAs for `InputUnavailableAsFailed` behaving the way that it does, the comment nearby that line tells the answer. The BMC will often remain powered up at all times, even when the host computer is powered down. However, when the host computer is powered down, about half the sensors will typically disappear, on a typical system. We do not want the fans to panic and enter failsafe mode just because these host-powered sensors are no longer showing up. When the host is powered off, there is little need to cool the system, so the fans can safely remain at their minimum speed. That\u0027s why we have this flag.\n\nAs you noticed, there\u0027s a difference between a sensor being present but malfunctioning, and a sensor that is missing entirely. Creating dummy sensors as placeholders might work well in some situations, but add unwanted clutter (think IPMI and Redfish sensor monitoring) in other situations. Regardless, design discussions are best had on that feature request, not here in a changelist.\n\nPerhaps a global compile-time option, not associated with any particular fan, might give people the chance to pick whatever behavior they prefer? We\u0027ve done this for some other behavioral changes recently. Here is one example: https://gerrit.openbmc.org/c/openbmc/phosphor-pid-control/+/68557\n\nIt\u0027s also key to avoid breaking existing behavior, even if the existing behavior is not as clean or logical as it could be. Reason is, people have real hardware running in real-world conditions right now, with this program running the way that it is right now. If we change things, we break a lot of behavior that people have depended on, even if they don\u0027t realize they\u0027re depending on it now. Such is life maintaining a mature program that has wide adoption in the field.",
      "parentUuid": "cdc8237b_9d7dbbf6",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e9a05abc_59daaef4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2024-12-03T09:43:29Z",
      "side": 1,
      "message": "\u003e As for InputUnavailableAsFailed behaving the way that it does, the comment nearby that line tells the answer. The BMC will often remain powered up at all times, even when the host computer is powered down. However, when the host computer is powered down, about half the sensors will typically disappear, on a typical system. We do not want the fans to panic and enter failsafe mode just because these host-powered sensors are no longer showing up. When the host is powered off, there is little need to cool the system, so the fans can safely remain at their minimum speed. That\u0027s why we have this flag.\n\nI would argue that the `_available` variable is retrieved from the `Available` D-Bus property. `if (!_typeFan \u0026\u0026 !_available \u0026\u0026 !_unavailableAsFailed) return false;` \u003d\u003e this line implies that if `Available` is false (usually updated from a propertiesChanged signal) and `InputUnavailableAsFailed`\u003dfalse \u003d\u003e this is NOT considered a failure. This is only valid if the host-power-dependent sensors are STILL on DBus and their `Available` is changed to false during poweroff. If they disappear during poweroff, signals are sent, (1) with the current behavior of D-Bus parsing method, swampd will rescan and ignore them anyhow, (2) with JSON parsing method, swampd is not aware of the disapearance nor any change to the sensor via propertiesChanged signal and it goes on \u003d\u003e `InputUnavailableAsFailed` has no effect here;\n\nWith what I said, I\u0027m confused whether the sensor with `InputUnavailableAsFailed`\u003dfalse is supposed have the allowance to be missing from D-Bus, or to be `unavailable`?\n\nIt looks like `InputUnavailableAsFailed`\u003dfalse is meant to override any failed case, the sensor can be missing anytime, even when swampd starts up with host-on, without affecting the zone.\n\n\u003e Perhaps a global compile-time option, not associated with any particular fan, might give people the chance to pick whatever behavior they prefer? We\u0027ve done this for some other behavioral changes recently. Here is one example: https://gerrit.openbmc.org/c/openbmc/phosphor-pid-control/+/68557\n\nAgreed. I will change it into a meson option. Can it be `HANDLE_MISSING_OBJPATHS`?",
      "parentUuid": "c703f18c_f6abf8b6",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c39ec20_d041a2dc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-12-09T09:32:14Z",
      "side": 1,
      "message": "Yes, that\u0027s a good name for it. Or `HANDLE_MISSING_OBJECT_PATHS` if you want to be more verbose.",
      "parentUuid": "e9a05abc_59daaef4",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0184e2c3_1847cf99",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 759,
      "author": {
        "id": 1001198
      },
      "writtenOn": "2024-11-27T09:17:24Z",
      "side": 1,
      "message": "I think it should be std::info instead std::cout",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "80e8a261_72e4adc5",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 759,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-11-27T10:52:53Z",
      "side": 1,
      "message": "Do you mean `lg2::info`? I haven\u0027t heard of `std::info`.\n\nThe diagnostic logging should be consistent. Let\u0027s follow the model of what has already been used in the program elsewhere. I think using `std::cerr` would be best here, since this is an error message, and it is what is already used elsewhere.",
      "parentUuid": "0184e2c3_1847cf99",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3bf4fdae_a001bcbe",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 759,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2024-11-28T09:57:31Z",
      "side": 1,
      "message": "Hi anh @Thang and @Josh, this is a log of the event that a sensor in the MissingIsAcceptable list is missing. So I still think this is not an error, but an informational log. That\u0027s why I use std::cout (for sensor that is not in MissingIsAcceptable list, std::cerr is used). Keep it as std::cout. Please re-open it if you think otherwise.",
      "parentUuid": "80e8a261_72e4adc5",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0cf02add_4b32065b",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 759,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-11-30T09:11:05Z",
      "side": 1,
      "message": "This is reasonable, thanks for the explanation. One note is that `std::cout` will not get collected into the syslog, unlike `std::cerr`, which will, in most cases. So, debug stuff and spammy stuff, useful only when debugging `swampd` itself and running it manually from the command line, can use `std::cout`.",
      "parentUuid": "3bf4fdae_a001bcbe",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "498acc28_1039184e",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 767,
      "author": {
        "id": 1001198
      },
      "writtenOn": "2024-11-27T09:17:24Z",
      "side": 1,
      "message": "Why did you move this loop from https://github.com/openbmc/phosphor-pid-control/blob/master/dbus/dbusconfiguration.cpp#L745? It seems that this for loop is repeated so many time and so much sensors are duplicated in the archivedSensorNames",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9e25c25f_70032371",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 767,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-11-27T10:52:53Z",
      "side": 1,
      "message": "Agreed, we should avoid code duplication. There is already a lot of cut-and-paste duplicated code in this program, and we should be cleaning this up, not adding to it.",
      "parentUuid": "498acc28_1039184e",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1e783598_2ea6efcd",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 767,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2024-11-28T09:57:31Z",
      "side": 1,
      "message": "Moved the loop back to where it was.\n\nTo discuss more, I see that for PID controller parsing, sensor DBus interfaces are collected for all `Inputs` sensors, and then processed after that (https://github.com/openbmc/phosphor-pid-control/blob/951aff4cd1ba07f6d25400b7ac87621e76267eab/dbus/dbusconfiguration.cpp#L745). But for Stepwise controller parsing, the DBus interfaces of each `Inputs` sensor are processed right after retrieved (https://github.com/openbmc/phosphor-pid-control/blob/951aff4cd1ba07f6d25400b7ac87621e76267eab/dbus/dbusconfiguration.cpp#L1002). Idk why there\u0027s a difference here.\n\nMoreover, there should be just one object path with a specific sensor name on D-Bus. If there are more than one, according to the behavior of the current code, the last one will overide the previous ones in `sensorConfig`. Why don\u0027t we simply directly pick the last one and get rid of the loop through `inputSensorInterfaces`.",
      "parentUuid": "9e25c25f_70032371",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b7c25145_738b168e",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 767,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-11-30T09:11:05Z",
      "side": 1,
      "message": "Good point. It is a configuration error to have two sensors with exactly the same object path. This configuration should be rejected, or at least loudly warned about. Having two sensors with exactly the same object path is unsupported and UB. We are free to clean up this parsing behavior as we see fit, when encountering this state, because such a configuration should never exist on a valid system, thus we have no worry about breaking any existing system\u0027s behavior.",
      "parentUuid": "1e783598_2ea6efcd",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "31fc7ddf_98c90113",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 767,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2024-12-03T09:43:29Z",
      "side": 1,
      "message": "Will try it in another patch to separate things.",
      "parentUuid": "b7c25145_738b168e",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bff64019_a8e30d7f",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 1076,
      "author": {
        "id": 1001198
      },
      "writtenOn": "2024-11-27T09:17:24Z",
      "side": 1,
      "message": "replace std::cout with std::info instead",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "db9ea09a_b9490191",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 1076,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-11-27T10:52:53Z",
      "side": 1,
      "message": "Same as above, prefer `std::cerr`.",
      "parentUuid": "bff64019_a8e30d7f",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "503970bc_f98a608b",
        "filename": "dbus/dbusconfiguration.cpp",
        "patchSetId": 7
      },
      "lineNbr": 1076,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2024-11-28T09:57:31Z",
      "side": 1,
      "message": "Same argument as above.",
      "parentUuid": "db9ea09a_b9490191",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd5e6705_dff943fa",
        "filename": "dbus/dbuspassive.cpp",
        "patchSetId": 7
      },
      "lineNbr": 103,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-11-27T10:52:53Z",
      "side": 1,
      "message": "I like your good detailed comments here! It is tricky logic, so it warrants a good exposition like this.",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "78a44cfc_448779ff",
        "filename": "dbus/dbuspassive.cpp",
        "patchSetId": 7
      },
      "lineNbr": 103,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2024-11-28T09:57:31Z",
      "side": 1,
      "message": "Thanks, I was afraid people won\u0027t bother to review it if they need to figure out the logic themselves from the code 😂.",
      "parentUuid": "cd5e6705_dff943fa",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5b3676aa_978f8e29",
        "filename": "dbus/dbusutil.cpp",
        "patchSetId": 7
      },
      "lineNbr": 93,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-11-27T10:52:53Z",
      "side": 1,
      "message": "This refactoring is a good cleanup. It should be a separate changelist, as it serves a different purpose, and it can be more easily accepted that way, as it is a less severe change.",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e5fa2cb8_bdfc4c45",
        "filename": "dbus/dbusutil.cpp",
        "patchSetId": 7
      },
      "lineNbr": 93,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2024-11-28T09:57:31Z",
      "side": 1,
      "message": "I see no where in the code this function would be helpful, except for my newly added line of code. I wonder if it can just stand as an unused function in a different patch?",
      "parentUuid": "5b3676aa_978f8e29",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e305e9f5_dcd7d65f",
        "filename": "dbus/dbusutil.cpp",
        "patchSetId": 7
      },
      "lineNbr": 93,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-11-30T09:06:36Z",
      "side": 1,
      "message": "I like the cleanup aspect of it, splitting a large function into smaller distinct units. I also like the symmetry of the `getSensorUnit` function with the existing `getSensorPath` function.",
      "parentUuid": "e5fa2cb8_bdfc4c45",
      "revId": "62cb6845ac1938a5b6b84cec59910929c718a360",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}