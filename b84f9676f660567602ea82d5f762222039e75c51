{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b526d9d0_b17fa334",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-03-01T01:49:05Z",
      "side": 1,
      "message": "Good idea. The handler will still be called if the timer is cancelled, though, as Boost is not very good or reliable about timer cancelling. Maybe set a global flag or something, so that the timer routine knows to do nothing and just exit, if Boost calls it when we are trying to cancel it instead.\nhttps://stackoverflow.com/questions/43168199/cancelling-boost-asio-deadline-timer-safely",
      "revId": "b84f9676f660567602ea82d5f762222039e75c51",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2cdf64b3_c4ceca77",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000559
      },
      "writtenOn": "2024-03-07T05:25:24Z",
      "side": 1,
      "message": "This line in the handler would help it to know nothing to do when timer is cancelled.\nhttps://gerrit.openbmc.org/c/openbmc/phosphor-pid-control/+/69727/5/main.cpp#193\n\nAgree there still a race condition even with above line. But it would be rare. Do you still want to see using a global flag in this patch?",
      "parentUuid": "b526d9d0_b17fa334",
      "revId": "b84f9676f660567602ea82d5f762222039e75c51",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5d5a5950_d4b0a730",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000520
      },
      "writtenOn": "2024-03-12T02:55:14Z",
      "side": 1,
      "message": "Yes please. In general, use of `cancel()` is a code smell. Boost has never been really reliable about the behaviour of a cancelled timer. Sometimes it will be called immediately, sometimes it will be called later, sometimes it won\u0027t be called at all.\n\nIt\u0027s often just better and safer to have a global flag `isCancelling` or something like that, then your timer handler can know to simply do nothing when it is called. It\u0027s similar to the `weak_ptr` trick used to protect timer handlers from trying to use objects that were deleted before the timer handler was called.",
      "parentUuid": "2cdf64b3_c4ceca77",
      "revId": "b84f9676f660567602ea82d5f762222039e75c51",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "252eafa4_13f5f59d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-10-27T20:34:26Z",
      "side": 1,
      "message": "\u003e In general, use of cancel() is a code smell.\n\nThis isn\u0027t and hasn\u0027t been the case.  General pattern is start timer, then when the operation succeeds, cancel the timer, which invokes the callback with operation_aborted.\n\n\u003e sometimes it won\u0027t be called at all.\n\nIf you\u0027ve seen this behavior, please document it, because that\u0027s never been the case as far as I\u0027ve known.\n\n\u003e It\u0027s often just better and safer to have a global flag isCancelling or something like that, then your timer handler can know to simply do nothing when it is called.\n\nThat\u0027s effectively what\u0027s happening when calling cancel() on a timer instance, it\u0027s just then the callback is queued immediately.",
      "parentUuid": "5d5a5950_d4b0a730",
      "revId": "b84f9676f660567602ea82d5f762222039e75c51",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}